{% extends 'base.html.twig' %}

{% block title %} {{ parent() }} - Boutique en ligne {% endblock %}

{% block stylesheets %} 
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
{{ parent() }} 
{% endblock %}

{% block body %}
 <!--Message-->
  {% for category, messages in app.flashes %}
      {% for message in messages %}
          <div class=" w-50 container-sm alert alert-{{ category }}">
          <button type="button" class="btn-close float-end" data-bs-dismiss="alert"></button>
              {{ message }}
          </div>
      {% endfor %}
  {% endfor %}
  <h1 class="titre">La Boutique</h1>

{% if articles is empty %}
  <h1 class="sk-title">Temporairement indisponible</h1>
{% else %}
  <!--Carousel-->
  <h2 class="titre">Vins de la semaine</h2>
  <div id="carouselExampleCaptions" class="carousel slide sk-container sk-carousel">
    <div class="carousel-indicators">
      {% for article in articles %}
        <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ loop.index0 }}" {% if loop.first %}class="active" aria-current="true"{% endif %} aria-label="Slide {{ loop.index }}"></button>
      {% endfor %}
    </div>
    <div class="carousel-inner">
      {% for article in articles %}
        <div class="carousel-item {% if loop.first %}active{% endif %}">
          <div class="d-flex align-items-center">
            <img class="sk-picture-carousell" src="{{ vich_uploader_asset(article) }}" class="d-block w-50" alt="{{ article.nom }}">
            <div class="d-none d-md-block d-flex align-items-center sk-caroussel-detail">
              <h5 class="text-center">{{ article.region }} - {{ article.millesime }}</h5>
              <p class="text-center">{{ article.description }}</p>
              <p class="text-center">{{ article.couleur }}</p>
              <p class="text-center">{{ article.prix }} €</p>
              <button class="sk-button-caroussel" onclick="addToCart('{{ article.id }}')">Ajouter au panier</button>
              <div class="sk-quantity-caroussel">
                <label  class="text-center w-50" for="quantity_{{article.id}}">Quantité:</label>
                <input class="quantity_{{ article.id }} w-50" type="number" name="quantity" min="1" value="1" onchange="updateQuantity('{{ article.id }}', this.value)">
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    <button class="carousel-control-prev sk-button-slide" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Précédent</span>
    </button>
    <button class="carousel-control-next sk-button-slide" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Suivant</span>
    </button>
  </div>

<div class="sk-divider"></div>

<div class="filters">
<h3>filtres</h3>

  
<!--Card-->
<div class="d-flex column-gap-3 sk-container">
  {% for article in articles %}
  <a href="#">
    <div class="card sk-card text-center">
      <img class="sk-picture-shop" src="{{ vich_uploader_asset(article) }}" alt="{{ article.nom }}">
      <div class="sk-cardbody">
        <h5 class="card-title sk-card-title mt-3">{{article.nom}}</h5>
        <p class="card-text sk-card-title">{{article.region}} - {{article.millesime}}</p>
        <p class="card-text sk-card-title">{{article.couleur}}</p>
        <p class="card-text sk-card-title">{{article.prix}} €</p>
        <button class="sk-button" onclick="addToCart('{{ article.id }}')">Ajouter au panier</button>
        <div class="sk-quantity">
          <label for="quantity_{{article.id}}">Quantité:</label>
          <input class="quantity_{{ article.id }}" type="number" name="quantity" min="1" value="1" onchange="updateQuantity('{{ article.id }}', this.value)">
        </div>
      </div>
    </div>
  </a>
  {% endfor %}
</div>
<div class="paginator">
  Page : 
  {{ knp_pagination_render(articles) }}
</div>

<script>
function addToCart(id) {
  var quantityInput = document.querySelector('.quantity_' + id);
  var quantity = parseInt(quantityInput.value);
  var url = "{{ path('shop_add', { 'id': 'VIN_ID', 'quantity': 'QUANTITY' }) }}";
  url = url.replace('VIN_ID', id);
  url = url.replace('QUANTITY', quantity);
  window.location.href = url;
}

function updateQuantity(id, value) {
  var quantityInput = document.querySelector('.quantity_' + id);
  quantityInput.value = value;
}
</script>

{% endif %}

{% block javascripts %} {{ parent()}}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
{% endblock %}

{% endblock %}
